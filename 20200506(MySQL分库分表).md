[参考链接](https://mp.weixin.qq.com/s/DKe2vPjO0B4YKGoX-Ixv7g)
#### 数据库瓶颈
1. IO瓶颈 <br>
第一种：磁盘读IO瓶颈，热点数据太多，数据库缓存放不下，每次查询时会产生大量的IO，降低查询速度 -> **分库和垂直分表**。<br>
第二种：网络IO瓶颈，请求的数据太多，网络带宽不够 -> **分库**
2. CPU瓶颈 <br>
第一种：SQL问题，如SQL中包含join，group by，order by，非索引字段条件查询等，增加CPU运算的操作 -> SQL优化，建立合适的索引，在业务Service层进行业务计算.<br>
第二种：单表数据量太大，查询时扫描的行太多，SQL效率低，CPU率先出现瓶颈 -> **水平分表**。

#### 分库分表
1. 水平分库

2. 水平分表

3. 垂直分库

4. 垂直分表

#### 分库分表带来的问题
1. 事务一致性问题（下一次再总结）
2. 跨节点关联查询join问题（跨库join问题）
	+ 全局表，所有模块都需要的一些表，可以再每个数据库都存一份
	+ 字段冗余，典型的反范式设计，空间换时间，比如在订单表里存USERNAME，适用于依赖字段比较少的情况
	+ 数据组装，第一次查询结果集id，第二次查询关联数据
	+ ER分片，关系型数据库中，可以将哪些存在关联关系的表记录存放在同一个分片上，分片内都是1对1或者1对多的关系，根据id主键分片
3. 跨节点分页、排序、函数问题、
	+ 单个分片时，直接定位
	+ 多个分片时，需要在每个分片中排序或者函数，然后执行分页操作
4. 全局主键避重问题
	+ UUID 性能高，没有网络消耗，但是需要存储空间多，建立索引和基于索引进行查询都存在性能问题，UUID的无序性会导致索引位置频繁变动，导致分页
	+ 结合数据库维护主键id表，第一种维护一张全局表，使用myisam引擎的表锁，单点获取主键，第二种，每个数据库维护一张表，记录当前数据库的主键，每次主键都会增长固定步长
	+ Snowflake分布式自增ID算法

#### 什么时候考虑分库分表
1. 能不分就不分
2. 数据量过大，影响运维业务。比如数据库备份操作、数据库DDL（索引操作）、经常更新表，出现锁等待
3. 业务需要，热点数据多，需要垂直分表
4. 数据量快速增长，考虑水平分表
